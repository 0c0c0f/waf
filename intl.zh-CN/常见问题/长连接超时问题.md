# 长连接超时问题 {#concept_ak4_dyl_q2b .concept}

## 问题描述 {#section_hkx_dyl_q2b .section}

在某些特定业务场景中，客户端在提交某个请求后，需要等待服务器处理超过 60 秒的时间才可以返回响应，并且在处理完毕之前服务器与客户端没有任何数据交互。

例如，您通过网页上传一个 Excel 表格，要求服务器处理其中的数据（处理时间约需 3 分钟），且在提交表格后 120 秒内，客户端与服务器之间没有任何数据交互（HTTP 或者 TCP 报文）。这种情况下，WAF 会返回一个 504 超时的响应给客户端，同时断开连接。

这是因为 WAF 不会维持超过 120 秒（没有任何数据交互）的长连接，而且该七层超时时间目前不支持修改。

## 解决方案 {#section_ikx_dyl_q2b .section}

建议您修改这种请求的交互方式，让这种长连接在 60s 内能有一些数据交互（如 ack 报文，心跳包，keep-alive 等任何可以维持会话的报文）。

鉴于用户场景的多样性，暂不提供代码级别的修改建议，请开发人员结合自身业务特性进行调整。

